## マスター・レプリカサーバでの事前準備
### ログディレクトリ作成

```bash
mkdir /var/log/rsyncd
```

### /etc/logrotate.d/rsyncd

```conf
/var/log/rsyncd/*log {
        missingok
        notifempty
        sharedscripts
}
```

## マスターサーバ(192.168.1.1)
- /etc/rsyncd.conf

```bash
uid = root
gid = root
read only = no
use chroot = no
max connections = 4
hosts allow = 192.168.0.0/16
transfer logging = yes
log file = /var/log/rsyncd/rsyncd.log
log format = %a %m %f %b

[web]
path = /var/www/example.com/
```

- 起動

```bash
systemctl start rsyncd
```

### レプリカサーバ(192.168.1.2)
- /etc/rsync/rsync.sh

```bash
#!/bin/bash

rsync -avz --delete rsync://192.168.1.1/web/ /var/www/example.com/
```

- cron

```bash
*/5 * * * * flock -n /run/lock/cron_rsync.lock /etc/rsync/rsync.sh 2>&1 | ts '[%Y-%m-%d %H:%M:%S]' >> /var/log/rsync/cron_rsync.log
```
## マスターサーバで設定

### postgresql.conf

```conf
listen_addresses = '*'
archive_mode = on 
archive_command= '/bin/cp %p /var/lib/pgsql/archive/%f'
restore_command = 'rsync -az rsync://192.168.1.1/archive/%f %p'
```

### archive ディレクトリの作成

```bash
mkdir /var/lib/pgsql/archive
chmod 700 /var/lib/pgsql/archive
chown postgres:postgres /var/lib/pgsql/archive
```

### pg_hba.conf

```conf
host    replication     repl       192.168.1.1/32         md5 
host    replication     repl       192.168.1.2/32         md5 
```

## 起動

```bash
systemctl start postgresql
```

## postgresへログインし、レプリケーションユーザーを作成

```sql
create role repl login replication password '********'; 
```

## スタンバイサーバで設定 
### マスターデータをコピー

```bash
sudo -u postgres pg_basebackup -h 192.168.1.1 -p 5432 -U repl -D /var/lib/pgsql/data -X stream --progress --verbose -R
```

### postgresql.conf

```bash
hot_standby = on
hot_standby_feedback = on
```

## 起動 

```
systemctl start postgresql
```
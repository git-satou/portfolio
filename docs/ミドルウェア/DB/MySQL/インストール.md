# MySQL インストール手順（CentOS7 / Amazon Linux2 向け）

## 対象環境

- RHEL9系では `mysql` パッケージがデフォルトで用意されているため、`dnf install` で MySQL 8.0 の導入が可能。
- 本ドキュメントでは、**CentOS7 / Amazon Linux2** に MySQL を導入する方法を記述。
- 起動や初期設定はどの環境でも共通。

---

## インストール手順

### 1. MySQL リポジトリ RPM のインストール

リポジトリURL（公式）：https://dev.mysql.com/downloads/repo/yum/

```bash
yum -y install http://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
```

---

### 2. バージョンを切り替える

#### ✅ MySQL 5.7 をインストールしたい場合

```bash
yum-config-manager --disable mysql80-community
yum-config-manager --enable mysql57-community
```

#### ✅ MySQL 8.0 をインストールしたい場合

```bash
yum-config-manager --disable mysql57-community
yum-config-manager --enable mysql80-community
```

---

### 3. バージョン確認（念のため）

```bash
yum info mysql-community-server
```

---

### 4. MySQL サーバのインストール

```bash
yum -y install mysql-community-server mysql-community-devel
```

#### クライアントだけ必要な場合

```bash
yum -y install mysql-community-client
```

---

### 5. GPG エラー対処（出た場合）

エラー例：  
`GPG Keys are configured as: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql`

対処：

```bash
rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2023
```

---

## MySQL 起動と初期設定

### 1. サービス起動と自動起動設定

```bash
systemctl enable --now mysqld
```

---

### 2. 初期パスワードの確認

```bash
grep "temporary password" /var/log/mysqld.log
```

---

### 3. セキュア初期設定の実行

```bash
mysql_secure_installation
```

実行ログ例：

```text
Enter password for user root:  ← [ログから取得した初期パスワード]

New password:  ← [新しいパスワード]
Re-enter new password:  ← [再入力]

Change the password for root ? : No
Remove anonymous users? : y
Disallow root login remotely? : y
Remove test database and access to it? : y
Reload privilege tables now? : y

All done!
```

---

## チューニング（任意）

- `mysql-slow.log` を利用する場合は、ファイルを事前に作成し、`mysqld.log` と同じオーナー・権限に設定しておくこと。

### `my.cnf` に追加する設定例

```ini
[mysqld]

log_timestamps = SYSTEM
slow_query_log = ON
slow_query_log-file = /var/log/mysql-slow.log
long_query_time = 1
```
## 事前準備

```bash
yum install libdb-devel
```

## ソースURL

URL: http://mirror.postfix.jp/postfix-release/

## postfix ユーザーの作成

```bash
groupadd -g 89 postfix
useradd -u 89 -g 89 -G mail -s /sbin/nologin -d /var/spool/postfix postfix
```

## make & make install

```bash
# opensslを使用する場合(参考)
make makefiles CCARGS="-DUSE_TLS -I/usr/local/include -I/usr/local/openssl-1.0.2u/include/openssl" AUXLIBS="-L/usr/local/lib -L/usr/local/openssl-1.0.2u/lib -lssl -lcrypto -lz -lm"

make
make install
```

- make installすると下記のような事を聞かれるので答える

```bash
Please specify the prefix for installed file names. Specify this ONLY
if you are building ready-to-install packages for distribution to OTHER
machines. See PACKAGE_README for instructions.
install_root: [/]  ※※※デフォルトでOK※※※

Please specify a directory for scratch files while installing Postfix. You
must have write permission in this directory.
tempdir: [/usr/local/src/postfix-***]  ※※※デフォルトでOK※※※

Please specify the final destination directory for installed Postfix
configuration files.
config_directory: [/etc/postfix]  ※※※デフォルトでOK※※※

Please specify the final destination directory for installed Postfix
administrative commands. This directory should be in the command search
path of adminstrative users.
command_directory: [/usr/sbin]  ※※※デフォルトでOK※※※

Please specify the final destination directory for installed Postfix
daemon programs. This directory should not be in the command search path
of any users.
daemon_directory: [/usr/libexec/postfix]  ※※※デフォルトでOK※※※

Please specify the final destination directory for Postfix-writable
data files such as caches or random numbers. This directory should not
be shared with non-Postfix software.
data_directory: [/var/lib/postfix]  ※※※デフォルトでOK※※※

Please specify the final destination directory for the Postfix HTML
files. Specify "no" if you do not want to install these files.
html_directory: [no]  ※※※デフォルトでOK※※※

Please specify the owner of the Postfix queue. Specify an account with
numerical user ID and group ID values that are not used by any other
accounts on the system.
mail_owner: [postfix]  ※※※デフォルトでOK※※※

Please specify the final destination pathname for the installed Postfix
mailq command. This is the Sendmail-compatible mail queue listing command.
mailq_path: [/usr/bin/mailq]  ※※※デフォルトでOK※※※

Please specify the final destination directory for the Postfix on-line
manual pages. You can no longer specify "no" here.
manpage_directory: [/usr/local/man]  ※※※デフォルトでOK※※※

Please specify the final destination pathname for the installed Postfix
newaliases command. This is the Sendmail-compatible command to build
alias databases for the Postfix local delivery agent.
newaliases_path: [/usr/bin/newaliases]  ※※※デフォルトでOK※※※

Please specify the final destination directory for Postfix queues.
queue_directory: [/var/spool/postfix]  ※※※デフォルトでOK※※※

Please specify the final destination directory for the Postfix README
files. Specify "no" if you do not want to install these files.
readme_directory: [no]  ※※※デフォルトでOK※※※

Please specify the final destination pathname for the installed Postfix
sendmail command. This is the Sendmail-compatible mail posting interface.
sendmail_path: [/usr/sbin/sendmail] /usr/sbin/postfix_sendmail
※※※！！！ここを変えないと既存のMTAのsendmailコマンドが上書きされてしまう！！！※※※
※※※上書きされても問題ならデフォルトでOK※※※

Please specify the group for mail submission and for queue management
commands. Specify a group name with a numerical group ID that is
not shared with other accounts, not even with the Postfix mail_owner
account. You can no longer specify "no" here.
setgid_group: [postdrop]  ※※※デフォルトでOK※※※

Please specify the final destination directory for Postfix shared-library
files.
shlib_directory: [no]  ※※※デフォルトでOK※※※

Please specify the final destination directory for non-executable files
that are shared among multiple Postfix instances, such as postfix-files,
dynamicmaps.cf, as well as the multi-instance template files main.cf.proto
and master.cf.proto.
meta_directory: [/etc/postfix]  ※※※デフォルトでOK※※※
```

## confの編集
- /etc/postfix/main.cf

```conf
smtp_tls_CAfile = /etc/pki/tls/cert.pem
smtp_tls_security_level = may
smtp_tls_loglevel = 1
```

- /etc/postfix/master.cf

```conf
#smtp      inet  n       -       n       -       -       smtpd
10025      inet  n       -       n       -       -       smtpd
```

## コンフィグチェック

```bash
/usr/sbin/postfix check
```

## systemctl

```conf
# /etc/systemd/system/postfix.service
[Unit]
Description=Postfix Mail Transport Agent (source build by Nnetworks Satou)
After=syslog.target network.target
Conflicts=sendmail.service exim.service

[Service]
Type=forking
PIDFile=/var/spool/postfix/pid/master.pid
EnvironmentFile=-/etc/sysconfig/network
PrivateTmp=true
CapabilityBoundingSet=~ CAP_NET_ADMIN CAP_SYS_ADMIN CAP_SYS_BOOT CAP_SYS_MODULE
ProtectSystem=true
PrivateDevices=true
ExecStartPre=-/usr/sbin/restorecon -R /var/spool/postfix/pid
ExecStart=/usr/sbin/postfix start
ExecReload=/usr/sbin/postfix reload
ExecStop=/usr/sbin/postfix stop

[Install]
WantedBy=multi-user.target
```
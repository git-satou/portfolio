## インストール

```bash
yum -y install tomcat
```

### /etc/sysconfig/tomcat

```conf
JAVA_OPTS=" \
  -Xloggc:/var/log/tomcat/gc.log \
  -XX:+PrintGCDetails \
  -XX:+PrintGCDateStamps \
  -XX:+PrintGCTimeStamps \
  -XX:+PrintTenuringDistribution \
"
```

## ApacheとTomcatの連携
### /etc/httpd/conf.d/tomcat.conf

```conf
<VirtualHost *:80>
    ServerName example.com
    ServerAlias www.example.com

    CustomLog logs/example.com_access.log combined
    ErrorLog logs/example.com_error.log

    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass ajp://localhost:8009/
    ProxyPassReverse / ajp://localhost:8009/
</VirtualHost>

<VirtualHost *:443>
    ServerName example.com
    ServerAlias www.example.com

    CustomLog logs/example.com_ssl_access.log combined
    ErrorLog logs/example.com_ssl_error.log

    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass ajp://localhost:8009/
    ProxyPassReverse / ajp://localhost:8009/

    SSLEngine on
    SSLCertificateFile /etc/httpd/ssl/example.com.crt
    SSLCertificateKeyFile /etc/httpd/ssl/example.com.key
    SSLCertificateChainFile /etc/httpd/ssl/example.com.ca
</VirtualHost>
```

## server.xmlの修正
### 8009ポートの有効化

```xml
    <Connector protocol="AJP/1.3"
               address="127.0.0.1"
               port="8009"
               maxParameterCount="1000"
               secretRequired="false"
               />
```

### 8080ポートの無効化

- 該当記述をコメントアウトする

## ログの整理
### catalina.outのローテート

- /etc/logrotate.d/tomcat

```conf
/usr/local/tomcat/logs/catalina.out {
    copytruncate
    compress
    delaycompress
    missingok
    create 0644 tomcat tomcat
}
```

### catalina.out以外のローテート

- /usr/local/bin/cleanup-tomcat-logs.sh

```conf
#!/bin/bash

LOGDIR="/var/log/tomcat"

# gzip
find $LOGDIR -mtime +1 -type f -name "*.log" | xargs --no-run-if-empty gzip
find $LOGDIR -mtime +1 -type f -name "*.txt" | xargs --no-run-if-empty gzip

# delete
find $LOGDIR -mtime +30 -type f -name "*.log.gz" -delete
find $LOGDIR -mtime +30 -type f -name "*.txt.gz" -delete
```

#### cron設定

```
# Tomcat log clean up
00 02 * * * /usr/local/bin/cleanup-tomcat-logs.sh > /dev/null 2>&1
```
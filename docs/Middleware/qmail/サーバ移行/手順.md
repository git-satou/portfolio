## 【新環境】インストール

```bash
cd /usr/local/src/qmail_package_cname/
./qmail_package.sh
```

## 【旧環境～新環境】データ移行
### 【旧環境】

```bash
cd /home/vpopmail/
tar zcfp domains.tar.gz ./domains/
scp domains.tar.gz <IP>:/home/vpopmail/
```

### 【新環境】

```bash
cd /home/vpopmail/
mv domains{,.old}
tar zxvfp domains.tar.gz
```

## 【新環境】旧環境から必ずコピーすべき設定ファイル

```text
/var/qmail/control/rcpthosts
/var/qmail/control/virtualdomains
/var/qmail/control/smtproutes
/var/qmail/users/assign
```

## 【新環境】仮想ユーザの割り当て反映

```bash
/var/qmail/bin/qmail-newu
```

## 【新環境】スクリプトの作成と起動
### init

```bash
ln -s /var/qmail/service/init.rc /etc/init.d/qmaild
```

```bash
chkconfig --add qmaild
chkconfig qmaild on
/etc/init.d/qmaild start
```

### systemctl

- /etc/systemd/system/qmaild.service

```conf
[Unit]
Description=Qmail with Vpopmail service
After=syslog.target network.target

[Service]
Type=forking
ExecStart=/var/qmail/service/init.rc start
ExecStop=/var/qmail/service/init.rc stop
KillMode=none

[Install]
WantedBy=multi-user.target
```

```bash
systemctl enable --now qmaild.service
```